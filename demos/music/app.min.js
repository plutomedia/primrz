function text(e,t){return e=e||1,text3D(e*textSize,t).center()}function Board(e){this.object=hub(),this.title=text3D(.15,e).center().colored(colorPlay).addTo(this.object).named("text"+e).at(0,.7,-1.3),this.btns=[],this.btnState=[],this.type=e,range(numButtons,function(e){var t=Math.floor(e/height),i=10*(midWidth-t),n=10*(e%height-midHeight),o=box(padSize,padSize,padDepth).colored(colorOff).named("btn"+e).latLng(n,i);box(1.1*padSize,1.1*padSize,.9*padDepth).colored(colorPlay).named("bevel"+e).addTo(o),o.addEventListener("select",this.select.bind(this,e)),o.addEventListener("enter",this.play.bind(this,e,0)),this.object.add(o),this.btns.push(o)}.bind(this))}var height=8,width=4,numButtons=width*height,midWidth=(width-1)/2,midHeight=(height-1)/2,colorOn=16777215,colorOff=16711680,colorPlay=16776960,boards=[],t=0,measure=0,lastMeasure=null,padSize=.22,padDepth=.02,textSize=.05,skipOne=!1,perMeasure=2/height,DIST=v3(),env=new Primrose.BrowserEnvironment({groundTexture:"../shared_assets/images/deck.png",font:"../shared_assets/fonts/helvetiker_regular.typeface.json",backgroundColor:0,useFog:!0,drawDistance:10,fullScreenButtonContainer:"#fullScreenButtonContainer"});Board.prototype.play=function(e,t){this.highlight(e,colorPlay),this.object.getWorldDirection(DIST);var i=.85*perMeasure;env.music.play(this.type,25-numButtons+3*e,.25,i,t).at(this.object.x,this.object.y,this.object.z,DIST.x,DIST.y,DIST.z),setTimeout(this.highlight.bind(this,e),1e3*i)},Board.prototype.update=function(){if(measure!==lastMeasure)for(var e=env.audio.context.currentTime,t=perMeasure*Math.ceil(e/perMeasure)-e,i=0;i<width;++i){var n=i*height+measure;this.btnState[n]&&this.play(n,t)}DIST.set(this.object.position.x,env.head.position.y,this.object.position.z),this.object.position.lerp(DIST,.01)},Board.prototype.highlight=function(e,t){t=t||this.btnState[e]&&colorOn||colorOff;var i=this.btns[e];i.colored(t).named(i.name)},Board.prototype.select=function(e,t){env.hasMouse&&"MousePointer"!==t.pointer.name||(this.btnState[e]=!this.btnState[e],this.highlight(e))},env.addEventListener("ready",function(){env.audio.ready.then(function(){var e=Primrose.Audio.Music.TYPES,t=e.length;e.forEach(function(e,i){var n=new Board(e);boards.push(n),env.scene.add(n.object),n.object.latLng(0,100*(i-(t-1)/2)/t)})}),Preloader.hide()}),env.addEventListener("update",function(){skipOne||((t+=env.deltaTime)>perMeasure&&(t-=perMeasure,measure=(measure+1)%height),boards.forEach(function(e){e.update()}),lastMeasure=measure),skipOne=!1}),window.addEventListener("focus",function(){skipOne=!0});