{"version":3,"file":"preloader.js","sources":["preloader/index.js"],"sourcesContent":["const prog = {\r\n  bar: null,\r\n  files: {},\r\n  loaded: 0,\r\n  total: 0,\r\n\r\n  findProgressBar() {\r\n    if(!this.bar){\r\n      this.bar = document.querySelector(\"progress\");\r\n    }\r\n  },\r\n\r\n  shrink(size){\r\n    this.findProgressBar();\r\n    if(this.bar) {\r\n      this.bar.style.height = size;\r\n    }\r\n  },\r\n\r\n  hide() {\r\n    this.findProgressBar();\r\n    if(this.bar) {\r\n      this.bar.style.display = \"none\";\r\n    }\r\n  },\r\n\r\n  thunk(evt) {\r\n    const file = evt.target.responseURL || evt.target.currentSrc;\r\n    if(file){\r\n      if(!this.files[file]){\r\n        this.files[file] = {};\r\n      }\r\n      const f = this.files[file];\r\n      if(typeof evt.loaded === \"number\") {\r\n        f.loaded = evt.loaded;\r\n        f.total = evt.total;\r\n      }\r\n      else if(evt.srcElement) {\r\n        const bs = evt.srcElement.buffered;\r\n        let min = Number.MAX_VALUE,\r\n          max = Number.MIN_VALUE;\r\n        for(let i = 0; i < bs.length; ++i){\r\n          min = Math.min(min, bs.start(i));\r\n          max = Math.max(max, bs.end(i));\r\n        }\r\n        f.loaded = 1000 * max;\r\n        f.total = 1000 * evt.srcElement.duration;\r\n      }\r\n    }\r\n\r\n    let total = 0, loaded = 0;\r\n    for(var key in this.files){\r\n      const f = this.files[key];\r\n      loaded += f.loaded;\r\n      total += f.total;\r\n    }\r\n\r\n    this.loaded = loaded;\r\n    this.total = total;\r\n\r\n    this.findProgressBar();\r\n\r\n    if(this.bar && total){\r\n      this.bar.max = total;\r\n      this.bar.value = loaded;\r\n    }\r\n  }\r\n},\r\n\r\n  curScripts = document.querySelectorAll(\"script\"),\r\n  curScript = curScripts[curScripts.length - 1],\r\n  scripts = [];\r\n\r\n[\"findProgressBar\", \"shrink\", \"hide\", \"thunk\"].forEach((n) => prog[n] = prog[n].bind(prog));\r\n\r\nlet loaded = 0;\r\n\r\nfunction get(file, done) {\r\n  const x = new XMLHttpRequest();\r\n  x.onload = done && function(){ done(x.response); }\r\n  x.onprogress = prog && prog.thunk;\r\n  x.open(\"GET\", file);\r\n  x.send();\r\n}\r\n\r\nfunction installScripts() {\r\n  if(!document.body){\r\n    setTimeout(installScripts, 0);\r\n  }\r\n  else if(window.DEBUG) {\r\n    if(scripts.length > 0) {\r\n      const file = scripts.shift(),\r\n        s = document.createElement(\"script\");\r\n      s.src = file;\r\n      s.onload = installScripts;\r\n      document.body.appendChild(s);\r\n    }\r\n  }\r\n  else{\r\n    const s = document.createElement(\"script\");\r\n    s.innerHTML = scripts.join(\"\\n\");\r\n    document.body.appendChild(s);\r\n  }\r\n}\r\n\r\nfunction getNextScript(file, i, arr) {\r\n  get(file, (contents) => {\r\n    if(window.DEBUG) {\r\n      scripts[i] = file;\r\n    }\r\n    else{\r\n      scripts[i] = contents;\r\n    }\r\n    ++loaded;\r\n    if(loaded === arr.length) {\r\n      installScripts();\r\n    }\r\n  });\r\n}\r\n\r\nif(!window.PRIMROSE_TELEMETRY_OPT_OUT) {\r\n  get(\"https://www.primrosevr.com/telemetry\");\r\n}\r\n\r\nif(curScript && curScript.dataset.files) {\r\n  curScript.dataset.files.split(\",\").forEach(getNextScript);\r\n}\r\n\r\nexport default prog;\r\n"],"names":[],"mappings":"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"}